画像の文字起こしを作成しました。

**ひんと：**

* λ式に変換できたら、λ式から元のプログラムコードを推測しよう
* λ式は、他の値に作用させることによってのみ、その値の中身を知ることができる。このため、λ式によるデータ構造のエンコーディングは、エンコーディングそれ自身にデータの"取り出しかた"が記述されている。この点に注意しておくと、真偽値や列や組のエンコーディングが理解しやすいぞ。
* 以下では『λ式ほげほげ』と言う際にほげほげがプログラムであることがあるけど、これは『ほげほげ』を更にλ式に変換したもの、を意味しているぞ。
* プログラムのλ式による表現は以下のようになっているぞ。
* 真偽値と条件文
* 真はλx.λy.xで、偽はλx.λy.yで表現されているぞ。（もし e1 e2 e3）は、（e1 e2 e3）として表現されているぞ。


* 関数
* 複数引数関数は、1引数関数の連鎖で表現されているぞ。たとえば（関数（x y z） e）はλx.λy.λz.eで表現されているぞ。


* 列（スタックの方がイメージしやすいならそちらでも可）
* 空列（空スタック）に対して複数の値を積んでいくことで、列のデータを作ることができるぞ。たとえば、この処理では文字列は文字コードの列として表現されているぞ。
* 空列はλc.λn.nとして、列lに値vを付け加えた列はλc.λn.c l vとして表現されているぞ。
* 列を扱う側は、列が空列の場合と付け加えられた列の場合とで場合分けすることで列の情報を取り出すぞ。（列分解 l （x y e1） e2）は（l （λx.λy.e1） e2）として表現されているぞ。


* 組（ペア）
* （組 e1 e2 ... en） をλ式 （λp. （（（p e1） e2） ... en）で、（組分解 （x1 x2 ...xn） e）をλ式（λx1.λx2. ... λxn. e）で表現されているぞ。


* 再帰関数
* 記号「再帰」は、λ式（λf.（λx. f （x x）） （λx. f （x x）））で表現されているぞ。
* このλ式はYコンビネータや不動点コンビネータと呼ばれているぞ。





---

* 整数
* 効率的に表現するために、整数は真偽値の列で表現されているぞ。整数は、まずその整数を2の補数表現でビット列に変換し、各ビットを真偽値にすることで真偽値列にしているぞ。


* 演算子
* +や大小比較などの演算子は、一応ちゃんと実装されているけど、単にコンパイル結果と見比べて置き換えるだけで解読には十分だぞ。


* 入出力
* 入出力の記号は、入出力の挙動を規定する「タグ」の組である（組 p1 p2）と、入出力対象や入出力後の挙動を表すλ式Qとの組である（組 （組 p1 p2） Q）で表現されているぞ。ここで、タグp1やp2は「チャーチエンコーディングされた数」だぞ。整数と違う表現のされかたをしていることに注意しよう。
* 出力
* 出力命令の表現では、p1が1になるぞ。
* p2は出力したいものによって変わるぞ。整数/文字列/画像を出力するときは、p2はそれぞれ0,1,2になるぞ。
* 出力命令（～を出力 e1 e2）のとき、Qは（組 e1 e2）になるぞ。


* 入力
* 出力命令の表現では、p1が2になるぞ。
* p2は出力したいものによって変わるぞ。整数/文字列を入力するときは、p2はそれぞれ0,1になるぞ。
* 出力命令（～を入力 x e）のとき、Qは（λx.e）になるぞ。


* 停止
* 停止命令では、p1とp2とQは全て0になるぞ。


* 入出力の表現を理解することは、インタプリタを書くためにとても重要だぞ。インタプリタは、「まず、λ式を組だと思ってp1,p2,Qに分解する。p1の値を調べ、1ならQをさらに組だと思って分解し...」のように、入出力の表現に沿ってλ式の構造を調べていくような実装になるはずだぞ。



---

* 画像出力
* 画像は「無限四分木」として表記されているぞ。プログラム（画像 真偽値b e左上 e右上 e左下 e右下）は、『現在の深さで解像度が十分なら、真偽値bが表す色（白か黒）を、不十分なら、左上～右下の4つの画像を田の字に並べたものを表示させる』ような画像になっているぞ。
* プログラムで書く際には、（再帰 （関数 （t） （画像 色 t t t t）））などと書くことで、「これ以上拡大してもずっと同じ色の画像」を表現することができるぞ。
* インタプリタが画像を出力する際には、指定された解像度まで木を掘ったあと、そこの色を出力するような動きになるはずだぞ。
* 画像は、λ式（組 真偽値b e左上 e右上 e左下 e右下）で表現されているぞ。
* プログラム章中で記号と簡約規則だけ紹介されていて例は無いものに、「画像分解」の記号があるが、これは挙動としては5つ組の「組分解」の挙動と全く同じだぞ。


* stars.txtの読解について
* l-文字列からSKI文字列までの変換は特に時間がかかるので、CやRustなどの早い言語で書くのがおすすめだぞ。
* stars.txtのデコード部では、『質問文を出力したあと「鍵文字列」を入力から受け取り、鍵が正しいかをチェックする。鍵が間違っていたら「間違い」を出力して終了。鍵が合ってる場合は、鍵データを出力したあと、鍵データを用いて画像データをデコードする』といったようなことをやっているぞ。正しい「鍵文字列」は、問題文を翻訳してそれに答えたり、鍵チェックの部分を解読したりすることで分かるぞ。


* 読まなくてもいい補足
* 組と画像で、挙動が同じなのに記号を分けているのは、型検査の都合上だぞ。